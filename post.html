<html>
    <head>
        <script src="/js/jquery.min.js"></script>
        <script src="/js/jq_rbapi.js"></script>
        <script language="javascript">
        var rb;
        $( document ).ready(function() {
            rb = new jq_rbapi("http://restbox");
            
            $( "#authForm" ).submit(function( event ) {         
            // Stop form from submitting normally
                    event.preventDefault();  
                    
                    var res = rb.auth(
                            $('[name=login]').val(),
                            $('[name=password]').val()
                    ).then(function(r)
                    {
                        $('#panel_auth').toggle();  
                        $('#panel_logout').toggle();
                    }).catch(function(error) 
                    {
                        alert(error); // Error: Not Found
                    });                      
            });

            $( "#newtaskform" ).submit(function( event ) {         
            // Stop form from submitting normally
                    event.preventDefault();  
                    
                    var res = rb.send('tables/save/tasks',
                        {
                            'name' : $( "#newtaskform" ).find('[name="name"]').val(),
                            'descr' : $( "#newtaskform" ).find('[name=descr]').val()
                        }
                    ).then(function(r)
                    {
                        load_tasks();
                    }).catch(function(error) 
                    {
                        alert(error); // Error: Not Found
                    });                      
            });

            $("#tasklist").click(function(e){
                load_tasks();
            });

            $("#btn_logout").click(function(e){
                rb.logout().then(function(r){
                    $('#panel_auth').toggle();  
                    $('#panel_logout').toggle();
                }).catch(function(error) 
                {
                    alert(error); // Error: Not Found
                }); 
            });

            load_tasks();
        });  

         function load_tasks()
            {
                rb.get('tables/tasks').then(function(_data)
                {
                    console.log(_data);
                    $('#tasks').html("");

                    var tasks_table = $('<table />');
                    
                    for(i=0;i<_data.items.length;i++)
                    {
                        tr_el = $('<tr />');
                       // tr_el.append($('<td />').append(i+1));

                        $.each(_data.items[i],function(index,value)
                        {
                            // действия, которые будут выполняться для каждого элемента массива
                            // index - это текущий индекс элемента массива (число)
                            // value - это значение текущего элемента массива                        
                            //выведем индекс и значение массива в консоль
                            //  console.log('Индекс: ' + index + '; Значение: ' + value);
                            tr_el.append($('<td />').append(value));
                        });

                        tasks_table.append(tr_el);

                        $('#tasks').append(tasks_table);
                    }
                }).catch(function(error) 
                {
                    alert(error); // Error: Not Found
                });   ;
            }                   
        </script>
    </head>
<body>
<h3>Add new task</h3>
<form method="post" action="http://restbox/?q=tables/save/tasks" id="newtaskform">
    Name: <input type="text" name="name"  /><br />
    Description: <textarea name="descr" rows="5" cols="12" ></textarea>    
    <input type="submit" value="SAVE"/>
</form>

<div>
<h4>TASKS</h4><button id="tasklist">GET </button>
<div id="tasks">
</div>
</div>

<div id="panel_auth">
    <h3>AUTH</h3>
    <form method="post" action="http://restbox/?q=auth" id="authForm" >
        <input type="text" name="login" value="vasyan" />
        <input type="password" name="password" value="" />
        <input type="submit" value="ENTER"/>
    </form>
</div>
<div id="panel_logout" style="display:none">
    <button id="btn_logout">Logout</button>
</div>

</body>
</html>